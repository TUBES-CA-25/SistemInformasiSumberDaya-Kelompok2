RewriteEngine On

# Allow static files (CSS, JS, Images, uploads)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^(assets|css|js|storage)/.*$ - [L]

# Route all requests to index.php with ?route= parameter (same as PHP built-in server)
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_URI} !^/.*\.php$
RewriteRule ^(.*)$ index.php?route=$1 [QSA,L]

# Security: Block direct access to PHP files except index.php and api.php
RewriteCond %{REQUEST_FILENAME} \.php$
RewriteCond %{REQUEST_URI} !^.*/?(index|api)\.php$
RewriteRule ^.*$ index.php [L]